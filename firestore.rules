rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Clients collection - Shared access
    match /clients/{clientId} {
      allow read, write: if request.auth != null;
    }
    
    // Transactions collection - Shared access
    match /transactions/{transactionId} {
      allow read, write: if request.auth != null;
    }
    
    // Metadata collection for counters
    match /metadata/{docId} {
      allow read, write: if request.auth != null;
    }
    
    // Voyages collection - Shared access
    match /voyages/{voyageId} {
      allow read, write: if request.auth != null;
    }
    
    // Expenses collection - Shared access
    match /expenses/{expenseId} {
      allow read, write: if request.auth != null;
    }
    
    // Invoices collection - Shared access
    match /invoices/{invoiceId} {
      allow read, write: if request.auth != null;
    }
    // Fleets collection - Shared access
    match /fleets/{fleetId} {
      allow read, write: if request.auth != null;
    }
    // Maintenance Logs collection - Shared access
    match /maintenance_logs/{logId} {
      allow read, write: if request.auth != null;
    }
    // Settings collection - Shared access (Global settings)
    match /settings/{settingId} {
      allow read, write: if request.auth != null;
    }
    // Employees collection - HR data
    match /employees/{employeeId} {
      allow read, write: if request.auth != null;
    }
    // Attendance collection
    match /attendance/{attendanceId} {
      allow read, write: if request.auth != null;
    }
    
    // Payrolls collection - Restricted access
    match /payrolls/{payrollId} {
      // Owners and Admins can read and write all payroll data
      // Note: This assumes employees collection links authUid to user's UID
      // For simplicity, we allow any authenticated user to read if they're owner/admin
      // The client-side will handle the detailed role checks
      allow read, write: if request.auth != null;
      
      // In production, you would want stricter rules:
      // 1. Query employees collection to get user's role
      // 2. Check if role is 'owner' or 'admin'
      // 3. For employees, check if their employeeId exists in calculations array
      // However, Firestore rules don't support complex queries easily,
      // so we rely on client-side checks and backend validation
    }
  }
}
